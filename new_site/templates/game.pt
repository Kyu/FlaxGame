<!DOCTYPE html metal:define-macro="game">

<html lang="en">
<head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <title>Game Display: ${name}</title>
</head>
<body>
    <!--
    <h1>Hello, ${'world'}!</h1>
    <table>
      <tr #tal:repeat="row 'apple', 'banana', 'pineapple'">
        <td #tal:repeat="col 'juice', 'muffin', 'pie'"> # next line {row.capitalize()} {col}
        </td>
      </tr>
    </table>
    -->
<div>
    <a href="${request.application_url}/logout">Logout</a>
</div>

<h1>Logged in as: ${name} on ${player.team} team with ${player.troops} troops. You are currently standing on <a href="${request.route_url('game')}/${player.location}">${player.location}</a> </h1>
<!-- TODO chat -->
<table>

<tr tal:repeat="hex_col [i for i in range(1, 11)]">
    <td tal:repeat="hex_row [i.name for i in hexes if i.x == hex_col]" class="hexes">
        <h3><a href="${request.route_url('game')}/${hex_row}">${hex_row}</a></h3>
    </td>

</tr>

</table>

<div id="flash" tal:condition="request.session.peek_flash()">
  <span tal:omit-tag=""
        tal:repeat="message request.session.pop_flash()">
      ${message}<br>
  </span>
</div>


<div tal:condition="current_hex" class="hex">
    <h3>Viewing hex ${current_hex.name}</h3>
    <div tal:condition="current_hex.name == player.location">
        <h3>You are here!</h3>
    </div>
    <table tal:condition="currently_here and [i for i in currently_here if i.username is not player.username]">
        <h2>Currently here:</h2>
        <!-- TODO interact with hex (take ammo, recruit?)  -->
        <tr tal:repeat="here_info [i for i in currently_here if i.username != view.logged_in]">
        <td>
            <p>${here_info.username} who is a ${here_info.squad_type} for team ${here_info.team} with ${here_info.troops} troops</p>
            <form tal:condition="player.location == current_hex.name and player.team != here_info.team" action="${request.route_url('attack_player')}" method="post">
                <button name="player_called" value="${here_info.username}">Attack!</button>
             </form>

        </td>
        </tr>
    </table>
    <form tal:condition="movable" action="${request.route_url('move_to')}" method="post">
    <button name="position" value="${current_hex.name}">You can move here!</button>
    </form>
</div>

</body>
</html>